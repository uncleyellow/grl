<div class="container mx-auto px-6 py-12">
    <div class="bg-white shadow-xl rounded-2xl p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
            <mat-icon class="text-primary-600 mr-3">calculate</mat-icon>
            Tính toán chi phí vận chuyển
        </h2>

        <!-- Loading State -->
        <div *ngIf="loading" class="flex justify-center items-center py-8">
            <mat-spinner diameter="40"></mat-spinner>
        </div>

        <!-- Form -->
        <form [formGroup]="totalsForm" *ngIf="!loading" class="space-y-8">
            <!-- Address Search Section -->
            <div class="bg-gray-50 p-6 rounded-xl space-y-6">
                <h3 class="text-xl font-semibold text-gray-700 flex items-center">
                    <mat-icon class="text-primary-600 mr-2">location_on</mat-icon>
                    Thông tin địa điểm
                </h3>

                <!-- Pickup Address -->
                <div class="flex gap-4 items-center">
                    <div class="flex-1 relative">
                        <mat-icon class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">local_shipping</mat-icon>
                        <input 
                            type="text" 
                            formControlName="pickupAddress"
                            placeholder="Nhập địa chỉ lấy hàng"
                            class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        >
                    </div>
                    <button 
                        type="button"
                        (click)="onAddressSearch()"
                        class="px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center gap-2"
                    >
                        <mat-icon>search</mat-icon>
                        Tìm kiếm
                    </button>
                </div>

                <!-- Delivery Address -->
                <div class="flex gap-4 items-center">
                    <div class="flex-1 relative">
                        <mat-icon class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">inventory_2</mat-icon>
                        <input 
                            type="text" 
                            formControlName="deliveryAddress"
                            placeholder="Nhập địa chỉ trả hàng"
                            class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        >
                    </div>
                    <button 
                        type="button"
                        (click)="onDeliveryAddressSearch()"
                        class="px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center gap-2"
                    >
                        <mat-icon>search</mat-icon>
                        Tìm kiếm
                    </button>
                </div>
            </div>

            <!-- Map Section -->
            <div class="bg-gray-50 p-6 rounded-xl">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <mat-icon class="text-primary-600 mr-2">map</mat-icon>
                    Bản đồ
                </h3>
                <div class="h-[500px] w-full rounded-lg overflow-hidden shadow-lg">
                    <div #map class="w-full h-full z-0"></div>
                </div>
                
                <!-- Map Instructions -->
                <div class="mt-4 bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <p class="text-blue-700 flex items-start">
                        <mat-icon class="mr-2">info</mat-icon>
                        <span>
                            Bạn có thể chọn điểm lấy và trả hàng bằng cách:
                            <br>1. Nhập địa chỉ vào ô tìm kiếm
                            <br>2. Click trực tiếp vào bản đồ (click lần đầu để chọn điểm lấy hàng, click lần hai để chọn điểm trả hàng)
                        </span>
                    </p>
                </div>
            </div>

            <!-- Route Selection Section -->
            <div class="bg-gray-50 p-6 rounded-xl space-y-6">
                <h3 class="text-xl font-semibold text-gray-700 flex items-center">
                    <mat-icon class="text-primary-600 mr-2">route</mat-icon>
                    Thông tin chuyến
                </h3>

                <!-- Route Selection -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">Chọn chuyến</label>
                    <div class="relative">
                        <mat-icon class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">train</mat-icon>
                        <select 
                            formControlName="route"
                            (change)="onRouteChange()"
                            class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                        >
                            <option value="">Chọn chuyến</option>
                            <option *ngFor="let route of totalsData" [value]="route.chuyen">
                                {{route.chuyen}}
                            </option>
                        </select>
                    </div>
                </div>

                <!-- Transport Type Selection -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">Loại vận chuyển</label>
                    <div class="flex gap-6">
                        <label class="inline-flex items-center">
                            <input 
                                type="radio" 
                                formControlName="transportType" 
                                value="both"
                                (change)="onTransportTypeChange()"
                                class="form-radio text-primary-600"
                            >
                            <span class="ml-2 flex items-center">
                                <mat-icon class="mr-1">local_shipping</mat-icon>
                                <mat-icon class="ml-1">train</mat-icon>
                                Cả hai
                            </span>
                        </label>
                        <label class="inline-flex items-center">
                            <input 
                                type="radio" 
                                formControlName="transportType" 
                                value="road"
                                (change)="onTransportTypeChange()"
                                class="form-radio text-primary-600"
                            >
                            <span class="ml-2 flex items-center">
                                <mat-icon class="mr-1">local_shipping</mat-icon>
                                Đường bộ
                            </span>
                        </label>
                        <label class="inline-flex items-center">
                            <input 
                                type="radio" 
                                formControlName="transportType" 
                                value="rail"
                                (change)="onTransportTypeChange()"
                                class="form-radio text-primary-600"
                            >
                            <span class="ml-2 flex items-center">
                                <mat-icon class="mr-1">train</mat-icon>
                                Đường tàu
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Price Details Section -->
            <div *ngIf="selectedRoute" class="bg-gray-50 p-6 rounded-xl">
                <h3 class="text-xl font-semibold text-gray-700 mb-6 flex items-center">
                    <mat-icon class="text-primary-600 mr-2">payments</mat-icon>
                    Chi tiết giá
                </h3>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-600 flex items-center">
                            <mat-icon class="mr-2 text-primary-600">route</mat-icon>
                            Khoảng cách lấy hàng:
                        </span>
                        <span class="font-medium">{{pickupDistance | number:'1.2-2'}} km</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-600 flex items-center">
                            <mat-icon class="mr-2 text-primary-600">route</mat-icon>
                            Khoảng cách trả hàng:
                        </span>
                        <span class="font-medium">{{deliveryDistance | number:'1.2-2'}} km</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-600 flex items-center">
                            <mat-icon class="mr-2 text-primary-600">local_shipping</mat-icon>
                            Giá đường bộ (per km):
                        </span>
                        <span class="font-medium">{{selectedRoute.duongBo | currency:'VND':'symbol-narrow':'1.0-0'}}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-600 flex items-center">
                            <mat-icon class="mr-2 text-primary-600">train</mat-icon>
                            Giá đường tàu:
                        </span>
                        <span class="font-medium">{{selectedRoute.duongTau | currency:'VND':'symbol-narrow':'1.0-0'}}</span>
                    </div>
                    <div class="border-t border-gray-200 my-4"></div>
                    <div class="flex justify-between items-center p-4 bg-primary-50 rounded-lg">
                        <span class="text-lg font-semibold text-gray-800 flex items-center">
                            <mat-icon class="mr-2 text-primary-600">calculate</mat-icon>
                            Tổng cộng:
                        </span>
                        <span class="text-xl font-bold text-primary-600">{{totalPrice | currency:'VND':'symbol-narrow':'1.0-0'}}</span>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
